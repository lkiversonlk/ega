function init_navbar_event(){$("#set-lan-en").click(changeLocale.bind(null,"en")),$("#set-lan-ch").click(changeLocale.bind(null,"ch"))}function init_mouse_event(e,i,r){var o=i.scene,a=-1,n=i.screenSpaceEventHandler;n.setInputAction(function(e){var n=i.camera.pickEllipsoid(e.endPosition,o.globe.ellipsoid);if(n){var t=Cesium.Cartographic.fromCartesian(n),s=Cesium.Math.toDegrees(t.longitude).toFixed(2),l=Cesium.Math.toDegrees(t.latitude).toFixed(2);$("#mouse-lon").html(s),$("#mouse-lat").html(l);var d=r.fromLatLngToGrid(l,s);if((-1==a||a!=d)&&($("#grid-owner").html($.i18n(FINDING_OWNER)),earth.grids(d,function(e,i){if(e)showError("contract call error");else{a=d;var r=i[1];$("#grid-lord-avatar").attr("src","/avatar/get/"+r);var o=i[0];$("#grid-status").html(GridStateEng[o]),$("#grid-owner").html(shortSpellAddress(r)),$("#grid-owner").prop("title",r),$("#oper-grid-price").html(web3.fromWei(i[2]))}}),$("#mouse-grid").html(d),show_grid_mark)){var c=r.fromGridIndexToDegrees(d);gridMark.polygon.hierarchy=Cesium.Cartesian3.fromDegreesArray(c),gridMark.polygon.show=!0}}else gridMark.polygon.show=!1},Cesium.ScreenSpaceEventType.MOUSE_MOVE),n.setInputAction(function(a){var n=i.camera.pickEllipsoid(a.position,o.globe.ellipsoid);if(n){var t=Cesium.Cartographic.fromCartesian(n),s=Cesium.Math.toDegrees(t.longitude).toFixed(2),l=Cesium.Math.toDegrees(t.latitude).toFixed(2),d=r.fromLatLngToGrid(l,s);$("[name=grid-idx]").val(d),e.grid_selected(d)}},Cesium.ScreenSpaceEventType.LEFT_CLICK)}var gridMark=null,show_grid_mark=!0;function init_galay_status_event(e,i){null==gridMark&&(gridMark=e.entities.add({name:"grid_selected",polygon:{height:1e4,material:Cesium.Color.GREY.withAlpha(.2),outline:!0}})),$("#check-show-grids").change(function(){var e=$(this).prop("checked");i.showGrids(e)}),$("#check-show-mark").change(function(){show_grid_mark=$(this).prop("checked"),gridMark.show=show_grid_mark})}function init_player_status_event(e,i){$("#player-claim").click(function(){e.withdrawal(function(e,i){e?showError("contract call error"):showInfo(i)})}),$("#player-refresh").click(function(){i.refresh_player_status()}),$("#player-grids-list").on("change",function(){$("[name=grid-idx]").val(this.value),i.grid_selected(this.value)}),$("#player-location").click(function(){navigator.geolocation.getCurrentPosition(function(e){viewer.camera.flyTo({destination:Cesium.Cartesian3.fromDegrees(e.coords.longitude,e.coords.latitude,1e6)})})})}function init_grid_oper_event(e,i,r,o,a){$("#buy-grid-btn").click(function(){var i=parseInt($("[name=grid-idx]").val());isNaN(i)?showError(NON_GRID_SELECTED):e.grids(i,function(r,o){if(r);else{if(0!=o[0])return void showError(GRID_NOT_ON_SELL);if(o[1]==web3.eth.coinbase)return void showError(YOU_ARE_ALREADY_OWNER);var a=o[2];0==a?e.minimalPrice(function(r,o){r||e.buyGrid(i,{value:o,gas:47e4},function(e,i){e||(showInfo("transaction id: "+i),console.log(e,i))})}):e.buyGrid(i,{value:a,gas:47e4},function(e,i){e||(showInfo("transaction id: "+i),console.log(e,i))})}})}),$("#search-grid").click(function(){var e=parseInt($("[name=grid-idx]").val());isNaN(e)||r.grid_selected(e)}),$("#del-grid-img-btn").click(function(){let r=parseInt($("[name=grid-idx]").val());isNaN(r)&&(showError(NON_GRID_SELECTED),returnn),e.grids(r,function(e,n){if(!e){var t=n[1];web3.eth.coinbase!=t?showError(NOT_GRID_OWNER):$validation.signWithTimestamp(web3,function(e,n){e||$.ajax({url:"/grid_avatar/del",method:"POST",data:{grid_idx:r,signature:JSON.stringify(n)}}).done(function(e){console.log(e);const{isOK:n}=e;!0===n?($("#del-grid-img-btn").addClass("disabled"),$("#grid-avatar img").each(function(){$(this).attr("src",NO_IMAGE)}),o.forceReloadConf(o.CATEGORY.GRID_CONF_CATEGORY,r,(e,o)=>{e?(showError("fail load conf"),console.log("fail to load grid configuration: "+e)):(i.updateGridAvatar(r,a),$("#del-grid-img-btn").removeClass("disabled"))})):showError(DELETE_GRID_AVATAR_FAIL)}).fail(e=>{showError(DELETE_GRID_AVATAR_FAIL)})})}})}),$("#sell-grid-btn").click(function(){var r=parseInt($("[name=grid-idx]").val());isNaN(r)?showError("non grid selected"):e.grids(r,function(o,a){if(!o){a[1]==web3.eth.coinbase?vex.dialog.prompt({message:"Set the sell price in ETH",placeholder:"Price",callback:function(o){if(o){var a=parseFloat(o);if(isNaN(a))showError("price invalid");else{i.fromGridIndexToXY(r);e.grids(r,function(i,o){if(!i){o[1]!=web3.eth.coinbase?showError("not owner of this grid"):e.sellGrid(r,web3.toWei(a,"ether"),{gas:47e4},function(e,i){e?showError("contract call error"):showInfo("transaction id: "+i)})}})}}}}):showError("you are not the owner of this grid")}})})}var fixedFrameTransform=Cesium.Transforms.localFrameToFixedFrameGenerator("north","west");function init_starship_event(e,i){var r=e.scene,o=new Cesium.Cartesian3,a=new Cesium.HeadingPitchRoll,n=r.primitives.add(Cesium.Model.fromGltf({url:"/gltf/red_baron/scene.gltf",modelMatrix:Cesium.Transforms.headingPitchRollToFixedFrame(i,a,Cesium.Ellipsoid.WGS84,fixedFrameTransform),minimumPixelPriceSize:128,shadows:Cesium.ShadowMode.DISABLED,scale:600}));return e.scene.preRender.addEventListener(function(e,r){o=Cesium.Cartesian3.multiplyByScalar(Cesium.Cartesian3.UNIT_Y,-1e4,o),i=Cesium.Matrix4.multiplyByPoint(n.modelMatrix,o,i),Cesium.Transforms.headingPitchRollToFixedFrame(i,a,Cesium.Ellipsoid.WGS84,fixedFrameTransform,n.modelMatrix)}),n}function init_satelite(e,i,r){var o=e.scene,a=new Cesium.Cartesian3,n=new Cesium.HeadingPitchRoll,t=o.primitives.add(Cesium.Model.fromGltf({url:"/gltf/satelite/scene.gltf",modelMatrix:Cesium.Transforms.headingPitchRollToFixedFrame(i,n,Cesium.Ellipsoid.WGS84,fixedFrameTransform),minimumPixelPriceSize:128,shadows:Cesium.ShadowMode.DISABLED,scale:600}));return e.scene.preRender.addEventListener(function(e,o){a=Cesium.Cartesian3.multiplyByScalar(Cesium.Cartesian3.UNIT_Y,r,a),i=Cesium.Matrix4.multiplyByPoint(t.modelMatrix,a,i),Cesium.Transforms.headingPitchRollToFixedFrame(i,n,Cesium.Ellipsoid.WGS84,fixedFrameTransform,t.modelMatrix)}),t}