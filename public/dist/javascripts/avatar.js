!function(t,e){"function"==typeof define&&define.amd?define(function(){return t.AvatarUpload=e()}):t.AvatarUpload=e()}(this,function(){var t=function(t){try{return JSON.parse(t)}catch(t){return!1}},e=function(t){const e={el:void 0,uploadUrl:"",uploadMethod:"post",uploadImageKey:"upload",uploadData:{},pretendUpload:!1,onProgress:void 0,onSuccess:void 0,onError:void 0};r=e,a=t,Object.keys(a).forEach(function(t){r[t]=a[t]});var r,a;if(this.config=e,!this.config.el)throw new Error("An element is required to manipulate");if(!this.config.uploadUrl&&!this.config.pretendUpload)throw new Error("Upload URL not specified");this.el=this.config.el,0===this.el.getElementsByClassName("avatar-upload__shell").length&&(this.renderInput(),this.bindInput()),this.progressText=this.el.querySelector("span"),this.imageWrapper=this.el.querySelector(".avatar-upload__image-wrapper")};e.prototype.renderInput=function(){var t=this.el.querySelector("img"),e=t.src,r=document.createElement("div");return r.className="avatar-upload__shell",r.innerHTML=['<div class="avatar-upload__wrapper avatar-upload--complete">','<div class="avatar-upload__image-wrapper">','<img src="'+e+'">',"</div>",'<img src="'+e+'" class="avatar-upload__faded-image">','<div class="avatar-upload__progress-wrapper">',"<span>0%</span>","</div>",'<input type="file">',"</div>"].join(""),t.parentNode.removeChild(t),this.el.appendChild(r),this},e.prototype.bindInput=function(t){this.el.querySelector("input").addEventListener("change",this.initiateUpload.bind(this),!0)},e.prototype.initiateUpload=function(t){var e=t.target.files[0];if(t.target.value=null,e.type.match(/image.*/)){var r=new FileReader;r.onload=this.displayUpload.bind(this),r.readAsDataURL(e),this.upload(e)}},e.prototype.displayUpload=function(t){var e=t.target.result;this.uiUploadStart(e)},e.prototype.upload=function(t){(this.config.pretendUpload?r:a)(t,this.config,{progress:this.uploadProgress.bind(this),success:this.uploadSuccess.bind(this),error:this.uploadError.bind(this)})},e.prototype.uploadProgress=function(t){this.uiUploadProgress(t),this.config.onProgress&&this.config.onProgress(t,this.el,this)},e.prototype.uploadSuccess=function(t,e){this.uiUploadSuccess(t,e),this.config.onSuccess&&this.config.onSuccess(t,e)},e.prototype.uploadError=function(t,e){this.uiUploadError(t,e),this.config.onError&&this.config.onError(t,e)},e.prototype.uiUploadStart=function(t){var e;Array.prototype.forEach.call(this.el.querySelectorAll("img"),function(r){e=r.src,r.src=t}),this.origSrc=e,this.el.querySelector(".avatar-upload__wrapper").className="avatar-upload__wrapper"},e.prototype.uiUploadProgress=function(t){this.progressText.textContent=t+"%",this.imageWrapper.style.width=t+"%"},e.prototype.uiUploadSuccess=function(t,e){this.progressText.textContent="0%",this.imageWrapper.style.width=null,this.el.querySelector(".avatar-upload__wrapper").className="avatar-upload__wrapper avatar-upload--complete"},e.prototype.uiUploadError=function(t,e){this.uiUploadSuccess();var r=this.origSrc;Array.prototype.forEach.call(this.el.querySelectorAll("img"),function(t){t.src=r})};var r=function(t,e,r){var a=0,o=setInterval(function(){if((a+=1)>100)return r.success(),clearInterval(o);r.progress(a)},50)},a=function(e,r,a){var o=new XMLHttpRequest,i=new FormData;o.upload.addEventListener("progress",function(t){a.progress(parseInt(t.loaded/t.total*100,10))}),o.onreadystatechange=function(e){4===o.readyState&&(200===o.status?a.success(o,t(o.response)):a.error(o,t(o.response)))},i.append(r.uploadImageKey,e);for(val in r.uploadData)i.append(val,r.uploadData[val]);const s=$("[name=grid-idx]").val();i.append("grid_idx",s);const n=$("#set-grid-link").val();i.append("grid_link",n),o.onerror=(t=>{showError("upload Error:"+t)}),$validation.signWithTimestamp(web3,function(t,e){t?console.error("Error occured when sign with timestamp"):(i.append("signature",JSON.stringify(e)),o.open(r.uploadMethod,r.uploadUrl),o.send(i))})};return e});